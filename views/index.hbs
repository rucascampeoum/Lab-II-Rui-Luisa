<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <h1>Ol√° Utilizador, venha ver a meteorologia</h1>
    <form name ="local" action="/clima">   
        <input name="texto" type="text" onblur="document.local2.texto.value = this.value;">
        <button type="submit">Submeter</button>
    </form>

     <form name="local2">
        <input id="repetido" name="texto" type="text">
    <button id="faves" type="submit">Guardar favorito</button>

              <p id="fave-list-text">Nenhum Item Adicionado</p>
              <ul class="list-group" id="fave-list">
              </ul>
    <button type="reset" id="clean"  class="btn btn-secondary">Limpar lista</button>
       </form>
    

<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script>
    $(document).ready(function () {

       $("#fave-list").hide();
       $("#repetido").focus();

       $("#repetido").hide();

      /*
       * check browser supports local storage
       */
      if (localStorage) {

        var faveList_string = localStorage.getItem('faveList');
        if (faveList_string) {
          $("#fave-list-text").hide();
          $("#fave-list").show();
          var faveList = JSON.parse(faveList_string);
          console.log(faveList);
          $.each(faveList, (index, text) => {
            var textoEncoded = encodeURIComponent(text);
            $("#fave-list").append(`<li class="list-group-item"><a href="http://localhost:3000/clima?texto=${textoEncoded}">${text}</a></li>`);
          });
        }
        
        $("form")
          /*
           * clear local storage when the form is reseted
           */
          .on('reset', function(){
            console.log('cleaning!...');
            localStorage.clear();
            location.reload();
          })
          /*
           * add to local storage when the form is submitted
           */
           document.getElementById('faves').onclick = function(){
            var faveList_string = localStorage.getItem('faveList');
            var faveList =[];

            if(faveList_string) {
              faveList = JSON.parse(faveList_string);
            }
            faveList.push($("#repetido").val());
            localStorage.setItem('faveList', JSON.stringify(faveList));
            console.log(localStorage);
          }
      }
    });
    </script>
</body>
</html>